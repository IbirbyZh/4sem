Мы хотим, чтобы чтение переменной произошло не раньше, чем мы попадем в критическую секцию, поэтому достаточно сделать в lock acquire барьер. В то же время мы хотим, чтобы запись произошла не позже выхода из кретической секции, поэтому в unlock сделаем release барьер. 

Если сделать бартеры более слабыми, то futex перестает работать как надо.

Ускорение произошло только при числе потоков больше 2 примерно на 4%.
